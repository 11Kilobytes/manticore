(* dispatch.hlop
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * Switch to the next thread from the host-vproc's ready queue.
 *)

#define TID	enum(0)

define @dequeue (vp : vproc) : (TID, cont(enum(0)));
define @switch-to (vp : vproc, tid : TID, fiber : cont(enum(0))) noreturn;

define inline @dispatch (vp : vproc) noreturn =
    let (tid : TID, fiber : cont(enum(0))) = @dequeue (vp)
    @switch-to (vp, tid, fiber)
;

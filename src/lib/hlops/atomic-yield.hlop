(* atomic-yield.hlop
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * Yield to the parent scheduler, but with the guarantee that signals are masked 
 * after the yield.
 *)

#include "types.def"

define @yield (vp : vproc / exh : exh) : unit;

define @atomic-yield (vp : vproc / exh : exh) : unit =
   let _ : unit = @yield (vp / exh)
   do vpstore(ATOMIC, vp, TRUE)
   return (UNIT)

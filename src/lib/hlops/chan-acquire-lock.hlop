(* chan-acquire-lock.hlop
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * Acquire the lock of a channel.
 *)

#include "events.def"

@define inline @chan-acquire-lock (ch : chan / _ : exh) : unit =
    fun spin (_ : unit / exh : exh) : unit =
	  if CH_TRY_LOCK(ch)
	    then apply spin (UNIT / exh)
	    else return UNIT
    (* in *)
      apply spin (UNIT / exh)
;

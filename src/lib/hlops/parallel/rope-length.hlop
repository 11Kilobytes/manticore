(* rope-length.hlop
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * A length operator for ropes (which were parrays in the surface program).
 *)

#include "types.def"
#include "ropes.def"

extern void M_Print (void *);

define @rope-length (r : rope / exh : exh) : ml_int =
  do ccall M_Print ("@rope-length 0\n\000")
  (* FIXME it's segfaulting right around here *)
  case r
    of LEAF(len:ml_int, _:list) => 
         do ccall M_Print ("@rope-length 1\n\000")
         return (len)
     | CAT (len:ml_int, _:ml_int, _:rope, _:rope) => 
         do ccall M_Print ("@rope-length 2\n\000")
         return (len)
  end (* case *)
;


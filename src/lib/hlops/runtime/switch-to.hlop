(* switch-to.hlop
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *)

#include "runtime-offsets.def"
#include "types.def"

define inline @set-fgs (vp : vproc, fgs : fgs / exh : exh) : unit;

define inline @switch-to (vp : vproc, fgs : fgs, fiber : fiber / exh : exh) noreturn =
  do vpstore (ATOMIC, vp, FALSE)
  let _ : unit =  @set-fgs (vp, fgs / exh)
  throw fiber (UNIT)
;

(* enqueue.hlop
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *
 * Enqueue a thread in the host-vproc's ready queue.
 *)

#include "runtime-offsets.def"

define inline @enqueue (vp : vproc, tid : enum(0), fiber : cont(enum(0))) : enum(0) =
    let tl = vpload(VP_RDYQ_TL, vp)
    let item = alloc(tid, fiber, tl)
    do vpstore(VP_RDYQ_TL, vp, item)
    return (enum(0))

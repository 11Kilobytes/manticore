(* switch-to.hlop
 *
 * COPYRIGHT (c) 2007 The Manticore Project (http://manticore.cs.uchicago.edu)
 * All rights reserved.
 *)

#include "runtime-offsets.def"

#define FALSE	enum(0)

define inline @switch-to (vp : vproc, tid : enum(0), fiber : cont(enum(0))) noreturn =
    do vpstore(CURRENT_TID, vp, tid)
    do vpstore(ATOMIC, vp, FALSE)
    throw fiber(enum(0))
;
